#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define HEALTHY 0 // Κατάσταση 0  = Υγιής
#define INFECTED 1 // Κατάσταση 1 = Μολυσμένος
#define IMMUNE 2 // Κατάσταση 2 = Ανοσία
#define N 1000 //Αριθμός Κόμβων

int main(){
    srand(time(NULL));

    FILE *fptr;

    fptr = fopen("infectB.txt","w");

    //Πίνακας των κόμβων
    int nodes[N] = {HEALTHY};

    //Get τον πρώτο infected κόμβο
    int infection = rand() % N;

    //Initialize το πρώτο infected κόμβο
    nodes[infection] = INFECTED;

    //Αύξηση του Counter των μολυσμένων
    float infectedCounter = 1;

    //Initialize τα steps 
    int steps = 0;   

    //Πίνακας για count των βημάτων του κάθε κόμβου προς το immunity
    int immunitySteps[N] = {0};

    //Μετάδοση της μόλυνσης μέχρι να μολυνθούν όλοι οι κόμβοι
    while((infectedCounter < N)){
        
        //Break απο την loop άμα όλοι οι κόμβοι αποκτήσουν ανοσία
        //DISCLAIMER:Δεν έχω ιδέα άμα είναι σωστό να το κάνω αυτό αλλα δουλεύει : )
        if(infectedCounter == 0){
            break;
        }

        //Spread σε random node
        for(int i = 0; i < infectedCounter; ++i){
            infection = rand() % N;
            
            //Μόλυνση κόμβου μόνο στην περίπτωση που είναι HEALTHY
            if(nodes[infection] == HEALTHY){
                nodes[infection] = INFECTED;
            }
        }

        //Check για το immunity status του κάθε μολυσμένου κόμβου 
        for(int i = 0;i < N; ++i){
            if(nodes[i] == INFECTED){
                //Αύξηση του step σε περίπτωση που είναι infected
                immunitySteps[i]++;

                //Gain immunity μετά απο 10 βήματα
                if(immunitySteps[i] >=10){
                    nodes[i] = IMMUNE;
                    infectedCounter--;
                }
            }
        }

        infectedCounter = 0;

        //Count το συνολικό αριθμό των μολυσμένων
        for(int j = 0; j < N; ++j){
            if(nodes[j] == INFECTED)
            {
                infectedCounter++;
            }
        }
        steps++;
        
        //printf("Step:%d Nodes:%d \n",steps,infectedCounter);
        fprintf(fptr,"%d;%0.3f \n",steps,(infectedCounter/N));
    }

    return 0;

}